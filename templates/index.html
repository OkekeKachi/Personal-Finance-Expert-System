<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Budget Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- âœ… Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <form id="budgetForm">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo" />
            <span class="logo-text">BrokeNoMore</span>
        </div>

        <div class="welcomeText" align="center">
            <p>Letâ€™s stop spending like Dangote. Get a saving strategy</p>
        </div>

        <div id="error" class="error-box" style="display: none;"></div>
        <br>

        <label for="income">Monthly Income (â‚¦):</label>
        <input type="text" name="income" id="income" required onkeypress="return isNumberKey(event)">

        <label for="goal">Savings Goal (â‚¦):</label>
        <input type="text" name="goal" id="goal" required onkeypress="return isNumberKey(event)">

        <label for="timeline">Timeline (months):</label>
        <input type="text" name="timeline" id="timeline" required onkeypress="return isNumberKey(event)">

        <label for="needs_pct">Needs (%):</label>
        <input type="text" name="needs_pct" id="needs_pct" onkeypress="return isNumberKey(event)">

        <label for="wants_pct">Wants (%):</label>
        <input type="text" name="wants_pct" id="wants_pct" onkeypress="return isNumberKey(event)">

        <label for="savings_pct">Savings (%):</label>
        <input type="text" name="savings_pct" id="savings_pct" onkeypress="return isNumberKey(event)">

        <p id="error"></p>

        <input type="submit" value="Generate Strategy">
    </form>

    <!-- âœ… Financial Tip of the Day -->
    <div style="margin: 40px auto 20px auto; padding: 15px; max-width: 600px; background-color: #f4f4f4; border-radius: 8px;">
        <h3>ðŸ’¡ Financial Tip of the Day</h3>
        <p id="dailyTip">Loading tip...</p>
    </div>

    <!-- âœ… Chart Section (hidden until form submission) -->
    <section id="chartSection" style="margin-top: 30px; text-align: center; display: none;">
        <h2>Budget vs Actual Spending</h2>
        <canvas id="budgetChart" width="600" height="300"></canvas>
    </section>

    <!-- âœ… Script -->
    <script>
        // Allow only numbers
        function isNumberKey(evt) {
            const charCode = (evt.which) ? evt.which : evt.keyCode;
            return !(charCode > 31 && (charCode < 48 || charCode > 57));
        }

        // Daily Tip Logic
        const tips = [
            "ðŸ’¡ 'Save first, spend later.' Always pay yourself before your expenses!",
            "ðŸ’¡ Track every expense for one month â€” awareness is the first step to control.",
            "ðŸ’¡ Build an emergency fund before investing â€” safety comes first.",
            "ðŸ’¡ Avoid impulse spending: wait 24 hours before buying anything unplanned.",
            "ðŸ’¡ Automate your savings â€” treat it like a fixed monthly bill.",
            "ðŸ’¡ The best time to invest was yesterday. The next best is today.",
            "ðŸ’¡ Cut your coat according to your cloth â€” not your neighborâ€™s.",
            "ðŸ’¡ Don't rely on one source of income. Create multiple streams.",
            "ðŸ’¡ Avoid lifestyle inflation â€” increase savings, not spending.",
            "ðŸ’¡ Use the 50/30/20 rule: Needs, Wants, and Savings respectively."
        ];
        const today = new Date();
        const start = new Date(today.getFullYear(), 0, 0);
        const diff = today - start;
        const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
        const tipIndex = dayOfYear % tips.length;
        document.getElementById('dailyTip').innerText = tips[tipIndex];

        // Handle chart
        let chart; // Global chart object

        document.getElementById('budgetForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const income = parseFloat(document.getElementById('income').value);
            const goal = parseFloat(document.getElementById('goal').value);
            const timeline = parseInt(document.getElementById('timeline').value);

            const needs = parseFloat(document.getElementById('needs_pct').value) || 0;
            const wants = parseFloat(document.getElementById('wants_pct').value) || 0;
            const savings = parseFloat(document.getElementById('savings_pct').value) || 0;

            const totalPct = needs + wants + savings;
            const errorBox = document.getElementById('error');
            errorBox.style.display = 'none';
            errorBox.textContent = '';

            if (isNaN(income) || isNaN(goal) || isNaN(timeline)) {
                errorBox.style.display = 'block';
                errorBox.textContent = 'ðŸš« Fill all required fields.';
                return;
            }

            if (goal / timeline > income) {
                errorBox.style.display = 'block';
                errorBox.textContent = 'ðŸš« Your goal is too high for this income and timeline.';
                return;
            }

            if (totalPct !== 100) {
                errorBox.style.display = 'block';
                errorBox.textContent = 'ðŸš« Budget percentages must add up to 100%.';
                return;
            }

            // âœ… Calculate budgeted values
            const budgeted = [
                income * (needs / 100),
                income * (wants / 100),
                income * (savings / 100)
            ];

            // âœ… Simulate actual values with slight variance (+/-10%)
            const actual = budgeted.map(amount => {
                const variance = amount * (Math.random() * 0.2 - 0.1); // +/- 10%
                return Math.round(amount + variance);
            });

            // âœ… Render Chart
            if (chart) chart.destroy(); // destroy existing chart
            const ctx = document.getElementById('budgetChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Needs', 'Wants', 'Savings'],
                    datasets: [
                        {
                            label: 'Budgeted (â‚¦)',
                            data: budgeted,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)'
                        },
                        {
                            label: 'Actual (â‚¦)',
                            data: actual,
                            backgroundColor: 'rgba(255, 99, 132, 0.6)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            document.getElementById('chartSection').style.display = 'block';
        });
    </script>

</body>
</html>